<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>个人信息修改</title>

		<!-- Set render engine for 360 browser -->
		<meta name="renderer" content="webkit">

		<!-- No Baidu Siteapp-->
		<meta http-equiv="Cache-Control" content="no-siteapp" />

		<!--<link rel="icon" type="image/png" href="assets/i/favicon.png">-->

		<!-- Add to homescreen for Chrome on Android -->
		<meta name="mobile-web-app-capable" content="yes">
		<!--<link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">-->

		<!-- Add to homescreen for Safari on iOS -->
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-title" content="Amaze UI" />
		<!--<link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">-->

		<!-- Tile icon for Win8 (144x144 + tile color) -->
		<!--<meta name="msapplication-TileImage" content="assets/i/app-icon72x72@2x.png">-->
		<meta name="msapplication-TileColor" content="#0e90d2">

		<link rel="stylesheet" href="../assets/css/amazeui.min.css">
		<link rel="stylesheet" href="../assets/css/app.css">


		<link rel="stylesheet" href="../css/header.css">
		<link rel="stylesheet" href="../css/CaseInfo.css">
		<style>

		</style>
	</head>

	<body>
		<form id="form1" class="am-form">
			<div class="con">
				<div class="con-upper-2">
					<header data-am-widget="header" class="am-header am-header-default">
						<div class="am-header-left am-header-nav">
							<a href="javascript:;" class="leftlink">
								<span class="am-icon-chevron-left am-icon-sm"></span>
							</a>
						</div>
						<h1 class="am-header-title">
				        <a href="javascript:;" class="titlelink">
				        	个人信息修改
				        </a>
				    </h1>
						<!--<div class="am-header-right am-header-nav">
						<a href="javascript:;" class="rightlink">
							<i class="am-header-icon am-icon-bars"></i>
						</a>
					</div>-->
					</header>
					<!--<div class="uppers">-->
						<!--<dl class="uppers-info">
							<dd>
								<div class="uppers-number">1801H7826642</div>
								<div class="uppers-txt">上报时间：<span>2018-01-04 14:52</span></div>
								<div class="uppers-txt">发生地址：<span>上海市园中路1号</span></div>
							</dd>
							<dt><img src="../images/map.png" class="maplink"></dt>
						</dl>-->

						<!--<div class="uppers-menu">
							<dl hre-name='跳转地址'>
								<dt><img src="../images/ICON/ico_财务管理_订单查询 (1).png"></dt>
								<dd>详情</dd>
							</dl>

							<dl hre-name='跳转地址'>
								<dt><img src="../images/ICON/状态-派单 (1).png"></dt>
								<dd>转派</dd>
							</dl>

							<dl class="on" hre-name='跳转地址'>
								<dt><img src="../images/ICON/日终批处理 (2).png"></dt>
								<dd>处置</dd>
							</dl>

							<dl hre-name='跳转地址'>
								<dt><img src="../images/ICON/_订单 处理中 (1).png"></dt>
								<dd>退单</dd>
							</dl>

							<dl hre-name='跳转地址'>
								<dt><img src="../images/ICON/待处理工单.png"></dt>
								<dd>延期</dd>
							</dl>
						</div>-->

					<!--</div>-->
				</div>
				<div class="con-lower-1">

					<div class="lowers-1">
						<!--个人信息-->
						<div class="lower">
							<div class="lower-title">个人信息</div>

							<div class="">
								
								<!--头像-->
								<div class="am-form-group">
									<label class="req-title" for="DISPOE_IMAGE">头像</label>
									<ul class="uploader-images" id="uploaderFiles">
									</ul>
									<span class="uploader-input" id="uploader">
										<input type="file" accept="image/*" id="DISPOE_IMAGE" data-validation-message="请选择1-3张照片" required/>
									</span>

									<!--照片预览-->
									<div class="gallery" id="gallery">
										<span class="gallery-img" id="galleryImg"></span>
										<div class="gallery-opr">
											<a href="javascript:;" rel="external nofollow" class="gallery-del">
												<span class="am-icon-trash am-icon-sm"></span>
											</a>
										</div>
									</div>
								</div>
								
								<!--性别-->
								<div class="am-form-group">
									<label class="req-title" for="DISPOSE_RESULT">性别</label>
									<select id="DISPOSE_RESULT" data-am-selected="{btnWidth: '100%' }">
										<option value="条目一" selected>男</option>
										<option value="条目二">女</option>
									</select>
								</div>

								<!--职位-->
								<div class="am-form-group am-form-icon">
									<div class="am-form-group">
										<label class="req-title" for="Job">职位</label>
										<input type="text" id="Job" data-validation-message="请输入职位名称" required/>
									</div>
								</div>
								
								<!--邮箱-->
								<div class="am-form-group am-form-icon">
									<div class="am-form-group">
										<label class="req-title" for="Email">邮箱</label>
										<input type="text" id="Email" data-validation-message="请输入邮箱" required/>
									</div>
								</div>

							</div>
						</div>

						<div class="lower-btn">
							<button type="submit" id="Save" class="am-btn am-btn-secondary am-btn-block">确 定</button>
						</div>

					</div>
				</div>
			</div>

			<input type="hidden" id="hfFile0" class="hfFile" />
			<input type="hidden" id="hd_piclist" />

		</form>
	</body>
	<script src="../js/jquery-3.2.1.min.js"></script>
	<script src="../assets/js/amazeui.min.js"></script>

	<script src="../js/public.js"></script>
	<script src="../js/processImg.js"></script>
	<script src="../js/exif.min.js"></script>

	<script>
		(function() {
			init();

			function init() {

				headerLink();
				uploader(); //上传图片

				Valid(); //验证提交

			}

		

			/********验证提交********/
			function Valid() {
				var $form = $('#form1');
				$form.validator({
					onValid: function(validity) {
					
						//通过验证效果
						var $field = $(validity.field);
						$field.closest('.am-form-group').find('.am-alert').hide();
						
						

					},
					onInValid: function(validity) {

						//未通过验证效果
						var $field = $(validity.field);
						var $group = $field.closest('.am-form-group');
						var $alert = $group.find('.am-alert');
						// 使用自定义的提示信息 或 插件内置的提示信息
						var msg = $field.data('validationMessage') || this.getValidationMessage(validity);

						if(!$alert.length) {
							$alert = $('<div class="am-alert am-alert-danger"></div>').hide().
							appendTo($group);
						}

						$alert.html(msg).show();

						
						
						/***重写照片上传区域验证效果***/
						if($field[0].id == "DISPOE_IMAGE") {
							console.log('id',$field[0].id)
							console.log('length',$("#uploaderFiles").find("li").length)
							if($("#uploaderFiles").find("li").length > 0) {
								$field.closest('.am-form-group').find('.am-alert').hide();
								$field.closest('.am-form-group').removeClass('am-form-error').addClass('am-form-success')
								$field.closest('input[type="file"]').removeClass('am-form-error').addClass('am-field-valid')
								validity.valid = true;
							}
						}
						/***重写照片上传区域验证效果***/
						
						
						

					},
					submit: function(validity) {
						var formValidity = this.isFormValid();
						
						//照片为空时，手动改变验证状态
						if($("#uploaderFiles").find("li").length == 0) {
							formValidity = false;
						}
						
						console.warn('验证状态：', formValidity ? '通过' : '未通过');
						
						
						if(formValidity) {
							Save()
						}
						return false;
					}
				});

			}
			/********提交********/
			function Save() {
				console.log('提交')

				uploadTaskImage();
				UpLoadImg();

			}

			/****************上传图片beg****************/
			function uploader() {

				var tmpl = '<li><img src="#url#" /></li>',
					$uploader = $("#uploader"),
					$uploaderFiles = $("#uploaderFiles");

				//点击添加图片
				compressImg('DISPOE_IMAGE', 'uploaderFiles', 800, function(src) {
					if(URL) {

						$uploaderFiles.append($(tmpl.replace('#url#', src)));

						//判断最后一张或者超过三张
						if($uploaderFiles.find("li").length >= 1) {
							$uploader.hide()
							return false;
						}
					}
				});

				//预览、删除照片
				preview("uploaderFiles",true,"DISPOE_IMAGE",1);

			}

			//确认提交照片
			function uploadTaskImage() {
				var ImageObj = $("#uploaderFiles").find("li");
				$(ImageObj).each(function(index, obj) {
					$("#hfFile" + index).val($(this).find('img').attr('src').replace('data:image/png;base64,', ''));
				});
			}

			//确认上传照片
			function UpLoadImg() {
				var $ahfFile = $('.hfFile');
				$ahfFile.each(function(index, item) {
					var file = $(this).val();
					if(file != "" && file != undefined && file != null) {
						//发送ajax请求上传照片，接收返回结果msg
						var msg = '';
						
						var hd_picnames = $("#hd_piclist").val();
						if(hd_picnames == "") {
							$("#hd_piclist").val(msg)
						} else {
							$("#hd_piclist").val(hd_picnames + "," + msg);
						}
					}
				})
			}
			/****************上传图片end****************/

		})(window);
	</script>

</html>